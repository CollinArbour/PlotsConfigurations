from collections import OrderedDict
from LatinoAnalysis.ShapeAnalysis.ShapeFactoryMulti import ShapeFactory

factory = ShapeFactory()
factory._treeName  = 'Events'
factory._energy    = '13TeV'
factory._lumi      = 59.74
factory._tag       = 'AZH_2018_v7'
factory._nThreads  = 1
factory.aliases    = OrderedDict([('bVeto', {'expr': '(Sum$( CleanJet_pt > 20.0 && abs(CleanJet_eta) < 2.5 && Jet_btagDeepB[CleanJet_jetIdx] > 0.4184 ) == 0)'}), ('bReq', {'expr': '(Sum$( CleanJet_pt > 30.0 && abs(CleanJet_eta) < 2.5 && Jet_btagDeepB[CleanJet_jetIdx] > 0.8953 ) >= 2)'}), ('btagSF', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFjesup', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_jes[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFjesdown', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_jes[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfup', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_lf[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfdown', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_lf[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfup', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_hf[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfdown', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_hf[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfstats1up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_lfstats1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfstats1down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_lfstats1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfstats2up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_lfstats2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFlfstats2down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_lfstats2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfstats1up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_hfstats1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfstats1down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_hfstats1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfstats2up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_hfstats2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFhfstats2down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_hfstats2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFcferr1up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_cferr1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFcferr1down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_cferr1[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFcferr2up', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_up_cferr2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('btagSFcferr2down', {'expr': '( TMath::Exp(Sum$( TMath::Log( (CleanJet_pt>30 && abs(CleanJet_eta)<2.5)*Jet_btagSF_deepcsv_shape_down_cferr2[CleanJet_jetIdx]+1*(CleanJet_pt<30 || abs(CleanJet_eta)>2.5) ) ) ) )', 'samples': ['ttV', 'VVV']}), ('Jet_PUIDSF', {'expr': 'TMath::Exp(Sum$((Jet_jetId>=2)*TMath::Log(Jet_PUIDSF_loose)))', 'samples': ['ttV', 'VVV']}), ('Jet_PUIDSF_up', {'expr': 'TMath::Exp(Sum$((Jet_jetId>=2)*TMath::Log(Jet_PUIDSF_loose_up)))', 'samples': ['ttV', 'VVV']}), ('Jet_PUIDSF_down', {'expr': 'TMath::Exp(Sum$((Jet_jetId>=2)*TMath::Log(Jet_PUIDSF_loose_down)))', 'samples': ['ttV', 'VVV']}), ('PromptGenLepMatch3l', {'expr': 'Alt$(Lepton_promptgenmatched[0]*Lepton_promptgenmatched[1]*Lepton_promptgenmatched[2], 0)', 'samples': ['ttV', 'VVV']}), ('Top_pTrw', {'expr': '(topGenPt * antitopGenPt > 0.) * (TMath::Sqrt(TMath::Exp(0.0615 - 0.0005 * topGenPt) * TMath::Exp(0.0615 - 0.0005 * antitopGenPt))) + (topGenPt * antitopGenPt <= 0.)', 'samples': ['top']}), ('SFweightEleUp', {'expr': 'LepSF3l__ele_mvaFall17V1Iso_WP90_tthmva_70__Up', 'samples': ['ttV', 'VVV']}), ('SFweightEleDown', {'expr': 'LepSF3l__ele_mvaFall17V1Iso_WP90_tthmva_70__Do', 'samples': ['ttV', 'VVV']}), ('SFweightMuUp', {'expr': 'LepSF3l__mu_cut_Tight_HWWW_tthmva_80__Up', 'samples': ['ttV', 'VVV']}), ('SFweightMuDown', {'expr': 'LepSF3l__mu_cut_Tight_HWWW_tthmva_80__Do', 'samples': ['ttV', 'VVV']}), ('lhe_mW1', {'expr': 'TMath::Sqrt(2. * LHEPart_pt[0] * LHEPart_pt[1] * (TMath::CosH(LHEPart_eta[0] - LHEPart_eta[1]) - TMath::Cos(LHEPart_phi[0] - LHEPart_phi[1])))', 'samples': ['WWewk']}), ('lhe_mW2', {'expr': 'TMath::Sqrt(2. * LHEPart_pt[2] * LHEPart_pt[3] * (TMath::CosH(LHEPart_eta[2] - LHEPart_eta[3]) - TMath::Cos(LHEPart_phi[2] - LHEPart_phi[3])))', 'samples': ['WWewk']}), ('gstarHigh', {'expr': 'Gen_ZGstar_mass <0 || Gen_ZGstar_mass > 4', 'samples': ['WZ']}), ('nCleanGenJet', {'linesToAdd': ['.L /afs/cern.ch/work/s/srudrabh/AZH/Analysis/CMSSW_10_6_4/src/PlotsConfigurations/Configurations/Differential/ngenjet.cc+'], 'samples': ['ttV', 'VVV'], 'class': 'CountGenJet'})])
factory.FixNegativeAfterHadd    = False


factory.makeNominals(   
     './data/',    
     '/afs/cern.ch/work/s/srudrabh/AZH/Analysis/CMSSW_10_6_4/src/PlotsConfigurations/Configurations/AToZH/Full2018_v7/rootFiles_AZH_2018_v7',     
      OrderedDict([('events', {'fold': 3, 'range': (1, 0, 2), 'name': '1', 'xaxis': 'events'}), ('njet', {'fold': 0, 'range': (10, 0, 10), 'name': 'ZH3l_njet', 'xaxis': 'N_{jet}'}), ('pt1', {'fold': 0, 'range': (10, 0.0, 200), 'name': 'Lepton_pt[0]', 'xaxis': 'lept1_p_{T} [GeV]'}), ('ptz', {'fold': 0, 'range': (20, 0, 400), 'name': 'ZH3l_pTZ', 'xaxis': 'ptz'}), ('checkmZ', {'fold': 0, 'range': (20, 0, 200), 'name': 'ZH3l_checkmZ', 'xaxis': 'checkmZ'}), ('ptjet0', {'fold': 0, 'range': (20, 0, 200), 'name': 'CleanJet_pt[0]', 'xaxis': 'Leading jet p_{T}'}), ('ptjet1', {'fold': 0, 'range': (20, 0, 200), 'name': 'CleanJet_pt[1]', 'xaxis': 'Subleading jet p_{T}', 'cuts': ['preselection', 'zmass_cut', 'jet_cut_4j', 'breq']})]), 
      OrderedDict([('preselection', '1'), ('zmass_cut', 'WH3l_ZVeto < 25'), ('jet_cut_4j', ' Alt$( CleanJet_pt[0], 0) > 30                     && Alt$( CleanJet_pt[1], 0) > 30                     && Alt$( CleanJet_pt[2], 0) > 30                     && Alt$( CleanJet_pt[3], 0) > 30                     && WH3l_ZVeto < 25                     '), ('breq', ' Alt$( CleanJet_pt[0], 0) > 30                && Alt$( CleanJet_pt[1], 0) > 30                && Alt$( CleanJet_pt[2], 0) > 30                && Alt$( CleanJet_pt[3], 0) > 30                && WH3l_ZVeto < 25                && bReq                ')]),      
      {'ttV': {'FilesPerJob': 5, 'name': ['###root://eoscms.cern.ch//eos/cms/store/group/phys_higgs/cmshww/amassiro/HWWNano/Autumn18_102X_nAODv7_Full2018v7/MCl1loose2018v7__MCCorr2018v7__l2loose__l2tightOR2018v7/nanoLatino_TTZjets__part11.root', '###root://eoscms.cern.ch//eos/cms/store/group/phys_higgs/cmshww/amassiro/HWWNano/Autumn18_102X_nAODv7_Full2018v7/MCl1loose2018v7__MCCorr2018v7__l2loose__l2tightOR2018v7/nanoLatino_TTZjets__part12.root', '###root://eoscms.cern.ch//eos/cms/store/group/phys_higgs/cmshww/amassiro/HWWNano/Autumn18_102X_nAODv7_Full2018v7/MCl1loose2018v7__MCCorr2018v7__l2loose__l2tightOR2018v7/nanoLatino_TTZjets__part13.root', '###root://eoscms.cern.ch//eos/cms/store/group/phys_higgs/cmshww/amassiro/HWWNano/Autumn18_102X_nAODv7_Full2018v7/MCl1loose2018v7__MCCorr2018v7__l2loose__l2tightOR2018v7/nanoLatino_TTZjets__part14.root', '###root://eoscms.cern.ch//eos/cms/store/group/phys_higgs/cmshww/amassiro/HWWNano/Autumn18_102X_nAODv7_Full2018v7/MCl1loose2018v7__MCCorr2018v7__l2loose__l2tightOR2018v7/nanoLatino_TTZjets__part15.root'], 'weight': 'XSWeight*SFweight3l*LepSF3l__ele_mvaFall17V1Iso_WP90_tthmva_70__mu_cut_Tight_HWWW_tthmva_80*LepCut3l__ele_mvaFall17V1Iso_WP90_tthmva_70__mu_cut_Tight_HWWW_tthmva_80*Jet_PUIDSF*btagSF*PromptGenLepMatch3l*METFilter_MC'}},   
      OrderedDict([('lumi_Uncorrelated', {'skipCMS': 1, 'type': 'lnN', 'name': 'lumi_13TeV_2018', 'samples': {'VVV': '1.015', 'ttV': '1.015'}, 'cuts': []}), ('lumi_XYFact', {'skipCMS': 1, 'type': 'lnN', 'name': 'lumi_13TeV_XYFact', 'samples': {'VVV': '1.02', 'ttV': '1.02'}, 'cuts': []}), ('lumi_LScale', {'skipCMS': 1, 'type': 'lnN', 'name': 'lumi_13TeV_LSCale', 'samples': {'VVV': '1.002', 'ttV': '1.002'}, 'cuts': []}), ('lumi_CurrCalib', {'skipCMS': 1, 'type': 'lnN', 'name': 'lumi_13TeV_CurrCalib', 'samples': {'VVV': '1.002', 'ttV': '1.002'}, 'cuts': []})]), 
     'MinIf$( WH3l_mOSll[], WH3l_mOSll[Iteration$] > 0) > 12             && Alt$(Lepton_pt[0],0)>25             && Alt$(Lepton_pt[1],0)>20             && Alt$(Lepton_pt[2],0)>15             && Alt$(Lepton_pt[3],0)<10             && abs(WH3l_chlll) == 1            ',      
     'ALL_ttV.2',
)    

